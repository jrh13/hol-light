# ProofTrace: Modern Proof Steps Recording for HOL Light

LICENSE: The usual Hol-light license applies.

ProofTrace is a lightweight proof steps recording solution for HOL Light. It
modifies the HOL Light kernel by introducing a new `proof` type and attaching
proofs to each `thm` generated by the kernel.

It is also entirely written in OCaml which makes it easy to use once HOL Light
is properly installed on a system.

The `proof` of a `thm` represents the tree of basic rewrites that were applied
to axioms and definitions to demonstrate the theorem.

# Generated Dataset

ProofTrace can generate three files from a loaded HOL Light context:

## `prooftrace.theorems`

This file dumps the sequence of `thm` demonstrated in the current HOL Light
context using a compact explicit `term` tree syntax. Each line is a marshalled
JSON object that represents a demonstrated theorem with its integer index.

```
{"id": 0, "th": {"hy": [], "cc": "C(C(c=,cT),C(C(c=,A(vp,vp)),A(vp,vp)))"}}
{"id": 1, "th": {"hy": [], "cc": "C(C(c=,A(vp,vp)),A(vp,vp))"}}
{"id": 2, "th": {"hy": [], "cc": "C(C(c=,cT),cT)"}}
{"id": 3, "th": {"hy": [], "cc": "C(C(c=,c=),c=)"}}
{"id": 4, "th": {"hy": [], "cc": "C(C(c=,C(c=,cT)),C(c=,C(C(c=,A(vp,vp)),A(vp,vp))))"}}
{"id": 5, "th": {"hy": [], "cc": "C(C(c=,C(C(c=,cT),cT)),C(C(c=,C(C(c=,A(vp,vp)),A(vp,vp))),cT))"}}
{"id": 6, "th": {"hy": [], "cc": "C(C(c=,C(C(c=,A(vp,vp)),A(vp,vp))),cT)"}}
{"id": 7, "th": {"hy": [], "cc": "cT"}}
```

## `prooftrace.proofs`

This file dumps the calculus rewrite that led to each `thm` demonstrated in the
current HOL Light context. Arguments of rewrites are either previously
demonstrated `thm` (represented by their integer index) or an exogenous `term`
represented by an explicit tree syntax.

```
{"id": 0, "pr": ["DEFINITION", "C(C(c=,cT),C(C(c=,A(vp,vp)),A(vp,vp)))", "T"]}
{"id": 1, "pr": ["REFL", "A(vp,vp)"]}
{"id": 2, "pr": ["REFL", "cT"]}
{"id": 3, "pr": ["REFL", "c="]}
{"id": 4, "pr": ["MK_COMB", 3, 0]}
{"id": 5, "pr": ["MK_COMB", 4, 2]}
{"id": 6, "pr": ["EQ_MP", 5, 2]}
{"id": 7, "pr": ["EQ_MP", 6, 1]}
```

## `prooftrace.names`

This files associate named `thm` in the current context (this is based on
parsing the entire HOL Light code subtree).

```
{"id": 1837, "nm": "ABS_SIMP"}
{"id": 6188, "nm": "AND_CLAUSES"}
{"id": 18, "nm": "AND_DEF"}
{"id": 15449, "nm": "AND_FORALL_THM"}
{"id": 1752, "nm": "BETA_THM"}
{"id": 29585, "nm": "BOOL_CASES_AX"}
{"id": 115216, "nm": "CHOICE_PAIRED_THM"}
````

# Installation

After checking out the HOL Light repository using `git` you simply need to
patch the `fusion.ml` file with:

```
$ git apply ProofTrace/fusion.ml.diff
```

You can then restart HOL Light as normal (not using any checkpointing technique
as all the theorems need to be reconstructed after the patch to build their
associated proofs).

# Usage

```
# #use "hol.ml";;

(* Possibly load other files... *)

# #use "ProofTrace/proofs.ml";;

# dump_theorems "ProofTrace/prooftrace.theorems";;
# dump_proofs "ProofTrace/prooftrace.proofs";;
# dump_names "ProofTrace/prooftrace.names";;
```
